<!-- topic-details.component.html -->
<div class="container-fluid bg-light py-5" *ngIf="topic">
  <div class="mx-auto p-4 shadow-lg rounded" style="max-width: 1400px; background: #fdfdfd;">
    <div class="row d-flex align-items-stretch g-4">

      <!-- Main Video Content -->
      <div class="col-lg-8 d-flex flex-column">
        <div class="mb-4">
          <h2 class="fw-bold mb-2 text-primary">{{ topic.title }}</h2>
          <p class="text-muted fs-6">{{ topic.description }}</p>
        </div>

        <div *ngIf="!selectedVideo" class="bg-dark rounded overflow-hidden mb-4 flex-grow-1">
          <img
            [src]="topic.imageUrl"
            class="w-100 h-100"
            style="min-height: 400px; object-fit: cover;"
          />
        </div>

        <div *ngIf="selectedVideo" class="bg-dark rounded overflow-hidden mb-4 flex-grow-1">
          <video
            [src]="selectedVideo.url"
            controls
            autoplay
            class="w-100 h-100 rounded"
            style="min-height: 400px;"
          ></video>
        </div>
      </div>

      <!-- Sidebar: Video List -->
      <div class="col-lg-4 d-flex flex-column">
        <div class="glass-sidebar flex-grow-1 p-4 rounded shadow-sm border position-relative mb-4 mt-4"
           style="backdrop-filter: blur(8px); background: rgba(255, 255, 255, 0.85);">
          
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold text-dark mb-0">
              <i class="bi bi-play-circle me-2 text-primary"></i>Course Content
            </h5>
            <!-- Add Video btn -->
            <button *ngIf="isAdmin" class="btn btn-outline-secondary d-flex align-items-center gap-1 shadow-sm px-3 py-1"
                    style="font-weight: 500;" (click)="addVideoForm.openNewForm()">
              <i class="bi bi-plus-circle-fill fs-5"></i> Add Video
            </button>
          </div>

          <div class="overflow-auto" style="max-height: 600px;">
            <div *ngFor="let video of videos"
              class="video-sidebar-item d-flex align-items-center mb-3 p-2 rounded border hover-shadow position-relative"
              [class.active-video]="selectedVideo?.title === video.title"
              (click)="playVideo(video)"
              style="cursor: pointer; transition: all 0.2s ease-in-out;">

              <!-- Left blue bar -->
              <div *ngIf="selectedVideo?.title === video.title"
                class="position-absolute start-0 top-0 bottom-0"
                style="width: 6px; background-color: #0d6efd; border-top-left-radius: 0.375rem; border-bottom-left-radius: 0.375rem;">
              </div>

              <!-- Triangle play icon -->
              <i *ngIf="selectedVideo?.title === video.title"
                class="bi bi-play-fill text-primary me-2 fs-5">
              </i>
              <img [src]="video.thumbnail" alt="thumb" class="rounded me-3"
                style="width: 80px; height: 60px; object-fit: cover;"/>
              <div class="w-100">
                <p class="mb-1 fw-semibold small text-dark text-truncate" style="max-width: 200px;">
                  {{ video.title }}
                </p>
                <!-- <small class="text-muted">5 min â€¢ Video</small> -->
              </div>


              <!-- Action Buttons -->
              <div class="d-flex gap-1 ms-2" *ngIf="isAdmin">
                <button class="btn btn-sm btn-outline-primary rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 32px; height: 32px;"
                        title="edit" (click)="updateVideoForm.openUpdateForm(video)">
                  <i class="bi bi-pencil-fill fs-6"></i>
                </button>

                <button class="btn btn-sm btn-outline-danger rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 32px; height: 32px;"
                        title="delete" (click)="deleteForm.openSelectedVideo(video)">
                  <i class="bi bi-trash-fill fs-6"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-add-video-form #addVideoForm></app-add-video-form>
<app-add-video-form #updateVideoForm></app-add-video-form>
<app-delete-form #deleteForm></app-delete-form>